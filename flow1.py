import json
import pandas as pd
from statsmodels.tsa.arima.model import ARIMA
from datetime import timedelta, datetime

# 历史客流数据
'''
history_data = {
    # ... （此处保持您的历史数据不变）
    "2024-04-01": [150, 180, 200, 220, 250, 280, 300, 320, 350, 380, 400, 380, 350, 320, 300, 280, 250, 220, 200, 180, 150, 120, 100, 80, 60, 40, 20, 10, 5, 2, 1],
    "2024-04-02": [160, 190, 210, 230, 260, 290, 310, 330, 360, 390, 410, 390, 360, 330, 310, 290, 260, 230, 210, 190, 160, 130, 110, 90, 70, 50, 30, 15, 8, 3, 1],
    "2024-04-03": [170, 200, 220, 240, 270, 300, 320, 340, 370, 400, 420, 400, 370, 340, 320, 300, 270, 240, 220, 200, 170, 140, 120, 100, 80, 60, 40, 25, 12, 5, 2],
    "2024-04-04": [180, 210, 230, 250, 280, 310, 330, 350, 380, 410, 430, 410, 380, 350, 330, 310, 280, 250, 230, 210, 180, 150, 130, 110, 90, 70, 50, 30, 15, 8, 3],
    "2024-04-05": [190, 220, 240, 260, 290, 320, 340, 360, 390, 420, 440, 420, 390, 360, 340, 320, 290, 260, 240, 220, 190, 160, 140, 120, 100, 80, 60, 40, 25, 12, 5],
    "2024-04-06": [170, 200, 220, 240, 270, 300, 320, 340, 370, 400, 420, 400, 370, 340, 320, 300, 270, 240, 220, 200, 170, 140, 120, 100, 80, 60, 40, 25, 12, 5],
    "2024-04-07": [150, 180, 200, 220, 250, 280, 300, 320, 350, 380, 400, 380, 350, 320, 300, 280, 250, 220, 200, 180, 150, 120, 100, 80, 60, 40, 20, 10, 5, 2]

}
'''
history_data = {
     "2024-04-01": [150, 180, 200, 220, 250, 280, 300, 320, 350, 380, 400, 380, 350, 320, 300, 280, 250, 220, 200, 180, 150, 120, 100, 80, 60, 40, 20, 10, 5, 2, 1,
                   160, 190, 210, 230, 260, 290, 310, 330, 360, 390, 410, 390, 360, 330, 310, 290, 260, 230, 210, 190, 160, 130, 110, 90, 70, 50, 30, 15, 8, 3, 1,
                   170, 200, 220, 240, 270, 300, 320, 340, 370, 400, 420, 400, 370, 340, 320, 300, 270, 240, 220, 200, 170, 140, 120, 100, 80, 60, 40, 25, 12, 5, 2,
                   180, 210, 230, 250, 280, 310, 330, 350, 380, 410, 430, 410, 380, 350, 330, 310, 280, 250, 230, 210, 180, 150, 130, 110, 90, 70, 50, 30, 15, 8, 3,
                   190, 220, 240, 260, 290, 320, 340, 360, 390, 420, 440, 420, 390, 360, 340, 320, 290, 260, 240, 220, 190, 160, 140, 120, 100, 80, 60, 40, 25, 12, 5,
                   170, 200, 220, 240, 270, 300, 320, 340, 370, 400, 420, 400, 370, 340, 320, 300, 270, 240, 220, 200, 170, 140, 120, 100, 80, 60, 40, 25, 12, 5,
                   150, 180, 200, 220, 250, 280, 300, 320, 350, 380, 400, 380, 350, 320, 300, 280, 250, 220, 200, 180, 150, 120, 100, 80, 60, 40, 20, 10, 5, 2],

    "2024-04-02": [160, 190, 210, 230, 260, 290, 310, 330, 360, 390, 410, 390, 360, 330, 310, 290, 260, 230, 210, 190, 160, 130, 110, 90, 70, 50, 30, 15, 8, 3, 1,
                   170, 200, 220, 240, 270, 300, 320, 340, 370, 400, 420, 400, 370, 340, 320, 300, 270, 240, 220, 200, 170, 140, 120, 100, 80, 60, 40, 25, 12, 5, 2,
                   180, 210, 230, 250, 280, 310, 330, 350, 380, 410, 430, 410, 380, 350, 330, 310, 280, 250, 230, 210, 180, 150, 130, 110, 90, 70, 50, 30, 15, 8, 3,
                   190, 220, 240, 260, 290, 320, 340, 360, 390, 420, 440, 420, 390, 360, 340, 320, 290, 260, 240, 220, 190, 160, 140, 120, 100, 80, 60, 40, 25, 12, 5,
                   170, 200, 220, 240, 270, 300, 320, 340, 370, 400, 420, 400, 370, 340, 320, 300, 270, 240, 220, 200, 170, 140, 120, 100, 80, 60, 40, 25, 12, 5,
                   150, 180, 200, 220, 250, 280, 300, 320, 350, 380, 400, 380, 350, 320, 300, 280, 250, 220, 200, 180, 150, 120, 100, 80, 60, 40, 20, 10, 5, 2],

    "2024-04-03": [170, 200, 220, 240, 270, 300, 320, 340, 370, 400, 420, 400, 370, 340, 320, 300, 270, 240, 220, 200, 170, 140, 120, 100, 80, 60, 40, 25, 12, 5, 2,
                   180, 210, 230, 250, 280, 310, 330, 350, 380, 410, 430, 410, 380, 350, 330, 310, 280, 250, 230, 210, 180, 150, 130, 110, 90, 70, 50, 30, 15, 8, 3, 1,
                   190, 220, 240, 260, 290, 320, 340, 360, 390, 420, 440, 420, 390, 360, 340, 320, 290, 260, 240, 220, 190, 160, 140, 120, 100, 80, 60, 40, 25, 12, 5,
                   170, 200, 220, 240, 270, 300, 320, 340, 370, 400, 420, 400, 370, 340, 320, 300, 270, 240, 220, 200, 170, 140, 120, 100, 80, 60, 40, 25, 12, 5, 2,
                   150, 180, 200, 220, 250, 280, 300, 320, 350, 380, 400, 380, 350, 320, 300, 280, 250, 220, 200, 180, 150, 120, 100, 80, 60, 40, 20, 10, 5, 2, 1,
                   160, 190, 210, 230, 260, 290, 310, 330, 360, 390, 410, 390, 360, 330, 310, 290, 260, 230, 210, 190, 160, 130, 110, 90, 70, 50, 30, 15, 8, 3, 1],
     "2024-04-04": [180, 210, 230, 250, 280, 310, 330, 350, 380, 410, 430, 410, 380, 350, 330, 310, 280, 250, 230, 210, 180, 150, 130, 110, 90, 70, 50, 30, 15, 8, 3,
                   190, 220, 240, 260, 290, 320, 340, 360, 390, 420, 440, 420, 390, 360, 340, 320, 290, 260, 240, 220, 190, 160, 140, 120, 100, 80, 60, 40, 25, 12, 5,
                   170, 200, 220, 240, 270, 300, 320, 340, 370, 400, 420, 400, 370, 340, 320, 300, 270, 240, 220, 200, 170, 140, 120, 100, 80, 60, 40, 25, 12, 5, 2,
                   150, 180, 200, 220, 250, 280, 300, 320, 350, 380, 400, 380, 350, 320, 300, 280, 250, 220, 200, 180, 150, 120, 100, 80, 60, 40, 20, 10, 5, 2, 1,
                   160, 190, 210, 230, 260, 290, 310, 330, 360, 390, 410, 390, 360, 330, 310, 290, 260, 230, 210, 190, 160, 130, 110, 90, 70, 50, 30, 15, 8, 3, 1,
                   170, 200, 220, 240, 270, 300, 320, 340, 370, 400, 420, 400, 370, 340, 320, 300, 270, 240, 220, 200, 170, 140, 120, 100, 80, 60, 40, 25, 12, 5],

    "2024-04-05": [190, 220, 240, 260, 290, 320, 340, 360, 390, 420, 440, 420, 390, 360, 340, 320, 290, 260, 240, 220, 190, 160, 140, 120, 100, 80, 60, 40, 25, 12, 5,
                   170, 200, 220, 240, 270, 300, 320, 340, 370, 400, 420, 400, 370, 340, 320, 300, 270, 240, 220, 200, 170, 140, 120, 100, 80, 60, 40, 25, 12, 5, 2,
                   180, 210, 230, 250, 280, 310, 330, 350, 380, 410, 430, 410, 380, 350, 330, 310, 280, 250, 230, 210, 180, 150, 130, 110, 90, 70, 50, 30, 15, 8, 3,
                   190, 220, 240, 260, 290, 320, 340, 360, 390, 420, 440, 420, 390, 360, 340, 320, 290, 260, 240, 220, 190, 160, 140, 120, 100, 80, 60, 40, 25, 12, 5,
                   170, 200, 220, 240, 270, 300, 320, 340, 370, 400, 420, 400, 370, 340, 320, 300, 270, 240, 220, 200, 170, 140, 120, 100, 80, 60, 40, 25, 12, 5,
                   150, 180, 200, 220, 250, 280, 300, 320, 350, 380, 400, 380, 350, 320, 300, 280, 250, 220, 200, 180, 150, 120, 100, 80, 60, 40, 20, 10, 5, 2],

    "2024-04-06": [180, 210, 230, 250, 280, 310, 330, 350, 380, 410, 430, 410, 380, 350, 330, 310, 280, 250, 230, 210, 180, 150, 130, 110, 90, 70, 50, 30, 15, 8, 3,
                   190, 220, 240, 260, 290, 320, 340, 360, 390, 420, 440, 420, 390, 360, 340, 320, 290, 260, 240, 220, 190, 160, 140, 120, 100, 80, 60, 40, 25, 12, 5,
                   170, 200, 220, 240, 270, 300, 320, 340, 370, 400, 420, 400, 370, 340, 320, 300, 270, 240, 220, 200, 170, 140, 120, 100, 80, 60, 40, 25, 12, 5, 2,
                   150, 180, 200, 220, 250, 280, 300, 320, 350, 380, 400, 380, 350, 320, 300, 280, 250, 220, 200, 180, 150, 120, 100, 80, 60, 40, 20, 10, 5, 2, 1,
                   160, 190, 210, 230, 260, 290, 310, 330, 360, 390, 410, 390, 360, 330, 310, 290, 260, 230, 210, 190, 160, 130, 110, 90, 70, 50, 30, 15, 8, 3, 1,
                   170, 200, 220, 240, 270, 300, 320, 340, 370, 400, 420, 400, 370, 340, 320, 300, 270, 240, 220, 200, 170, 140, 120, 100, 80, 60, 40, 25, 12, 5],

  "2024-04-07": [190, 220, 240, 260, 290, 320, 340, 360, 390, 420, 440, 420, 390, 360, 340, 320, 290, 260, 240, 220, 190, 160, 140, 120, 100, 80, 60, 40, 25, 12, 5,
                   170, 200, 220, 240, 270, 300, 320, 340, 370, 400, 420, 400, 370, 340, 320, 300, 270, 240, 220, 200, 170, 140, 120, 100, 80, 60, 40, 25, 12, 5, 2,
                   180, 210, 230, 250, 280, 310, 330, 350, 380, 410, 430, 410, 380, 350, 330, 310, 280, 250, 230, 210, 180, 150, 130, 110, 90, 70, 50, 30, 15, 8, 3,
                   190, 220, 240, 260, 290, 320, 340, 360, 390, 420, 440, 420, 390, 360, 340, 320, 290, 260, 240, 220, 190, 160, 140, 120, 100, 80, 60, 40, 25, 12, 5,
                   170, 200, 220, 240, 270, 300, 320, 340, 370, 400, 420, 400, 370, 340, 320, 300, 270, 240, 220, 200, 170, 140, 120, 100, 80, 60, 40, 25, 12, 5,
                   150, 180, 200, 220, 250, 280, 300, 320, 350, 380, 400, 380, 350, 320, 300, 280, 250, 220, 200, 180, 150, 120, 100, 80, 60, 40, 20, 10, 5, 2],

    "2024-04-08": [180, 210, 230, 250, 280, 310, 330, 350, 380, 410, 430, 410, 380, 350, 330, 310, 280, 250, 230, 210, 180, 150, 130, 110, 90, 70, 50, 30, 15, 8, 3,
                   190, 220, 240, 260, 290, 320, 340, 360, 390, 420, 440, 420, 390, 360, 340, 320, 290, 260, 240, 220, 190, 160, 140, 120, 100, 80, 60, 40, 25, 12, 5,
                   170, 200, 220, 240, 270, 300, 320, 340, 370, 400, 420, 400, 370, 340, 320, 300, 270, 240, 220, 200, 170, 140, 120, 100, 80, 60, 40, 25, 12, 5, 2,
                   150, 180, 200, 220, 250, 280, 300, 320, 350, 380, 400, 380, 350, 320, 300, 280, 250, 220, 200, 180, 150, 120, 100, 80, 60, 40, 20, 10, 5, 2, 1,
                   160, 190, 210, 230, 260, 290, 310, 330, 360, 390, 410, 390, 360, 330, 310, 290, 260, 230, 210, 190, 160, 130, 110, 90, 70, 50, 30, 15, 8, 3, 1,
                   170, 200, 220, 240, 270, 300, 320, 340, 370, 400, 420, 400, 370, 340, 320, 300, 270, 240, 220, 200, 170, 140, 120, 100, 80, 60, 40, 25, 12, 5],

    "2024-04-09": [190, 220, 240, 260, 290, 320, 340, 360, 390, 420, 440, 420, 390, 360, 340, 320, 290, 260, 240, 220, 190, 160, 140, 120, 100, 80, 60, 40, 25, 12, 5,
                   170, 200, 220, 240, 270, 300, 320, 340, 370, 400, 420, 400, 370, 340, 320, 300, 270, 240, 220, 200, 170, 140, 120, 100, 80, 60, 40, 25, 12, 5, 2,
                   180, 210, 230, 250, 280, 310, 330, 350, 380, 410, 430, 410, 380, 350, 330, 310, 280, 250, 230, 210, 180, 150, 130, 110, 90, 70, 50, 30, 15, 8, 3,
                   190, 220, 240, 260, 290, 320, 340, 360, 390, 420, 440, 420, 390, 360, 340, 320, 290, 260, 240, 220, 190, 160, 140, 120, 100, 80, 60, 40, 25, 12, 5,
                   170, 200, 220, 240, 270, 300, 320, 340, 370, 400, 420, 400, 370, 340, 320, 300, 270, 240, 220, 200, 170, 140, 120, 100, 80, 60, 40, 25, 12, 5,
                   150, 180, 200, 220, 250, 280, 300, 320, 350, 380, 400, 380, 350, 320, 300, 280, 250, 220, 200, 180, 150, 120, 100, 80, 60, 40, 20, 10, 5, 2]

}


# 将数据转换为DataFrame
data_list = []
for date_str, values in history_data.items():
    # 只取enumerate产生的元组中的索引i
    hours, minutes = zip(*[(idx // 6, idx % 6 * 10) for idx, _ in enumerate(values)])  # 修改这里，使用idx
    data_list.extend([{'date': datetime.strptime(f"{date_str} {h:02d}:{m:02d}", '%Y-%m-%d %H:%M'), 'value': v} 
                      for h, m, v in zip(hours, minutes, values)])

# 余下代码保持不变...

df = pd.DataFrame(data_list).set_index('date').sort_index()

# 确定ARIMA模型参数（这里仅示例，实际应用中应通过AIC等指标选择最优参数）
p, d, q = 2, 1, 0  # 示例参数

# 训练模型
model = ARIMA(df['value'], order=(p, d, q))
model_fit = model.fit()

# 预测2024-04-08全天数据（每10分钟一次）
forecast_date = datetime(2024, 4, 8)
forecast_dates = pd.date_range(start=forecast_date.strftime('%Y-%m-%d 00:00'), periods=144, freq='10T')  # 每天144个10分钟间隔直到23:40

# 预测
forecast = model_fit.forecast(steps=len(forecast_dates))
forecast_df = pd.DataFrame({'date': forecast_dates, 'forecast_value': forecast})

# 打印预测结果
print(forecast_df.to_string(index=False))
